<% block_me "<h3>comment on this project</h3>" do%>

  <% if session[:user_id] %>
    
    <!--  This empty form tag prevents Rails from removing the following form
          tag from the generated page -->
    <form name="redHerring"></form>
    <div id="commentAdded" style="color: green; display:none;">comment added</div>
    <div id="commentAddFailed" style="color: red; display:none;">comment not added</div>
    <% form_remote_tag :url => {:action => 'add_comment'}, 
                 :update  => 'projectCommentsListContainer', 
                 :loading => "document.forms.commentList.submitButton.disabled = true;",
                 :loaded  => "document.forms.commentList.submitButton.disabled = false;" + 
                             "document.forms.commentList.text.value = '';",
                 :success => "document.getElementById('commentAdded').style.display='';" + 
                             "setTimeout(\"Effect.Fade('commentAdded')\", 3000);",
                 :failure => "document.getElementById('commentAddFailed').style.display='';" + 
                             "setTimeout(\"Effect.Fade('commentAddFailed')\", 3000);",
                 :html    => { :name => "commentList" } do -%>
      <textarea rows="5" 
                cols="40" 
                name="text" 
                onbeforepaste="adjustTextarea(this, 150)" 
                oninput="adjustTextarea(this, 150)" 
                onkeypress="adjustTextarea(this, 150)"></textarea>
      <input type="hidden" name="project_id" value="<%= project.id %>" />
      <br />
      <input type="submit" name="submitButton" value="Add comment" />
    <% end -%>
    
  <% else %>
  
    <div>
      <%= link_to "login", 
                  {:controller => :profile, :action => :login}, 
                  :class => "header" %>
      or 
      <%= link_to "create", 
                  {:controller => :profile, :action => :add_user}, 
                  :class => "header" %>
      an account to leave a comment
    </div>
  <% end %>

  <div id="projectCommentsListContainer">
    <%= render :partial=>"comment_list_contents", :locals=>{:project => project} %>
  </div>

<% end %>
